# CodeDevil 作業ログ 2025年12月

## 2025-12-01 作業概要

### 天使のノート・悪魔のノート全面書き直し

#### 背景
- 既存の悪魔のノートは皮肉度にバラつきがあった（★★〜★★★★★）
- 天使のノートは003由来の10件のみで、しかも皮肉混じりだった
- 天使と悪魔の区別が曖昧になっていた

#### 方針決定
- **天使のノート**: 本当に役立つTips、ベストプラクティス、注意点
- **悪魔のノート**: 本物の皮肉（★★★★★レベル）、開発者あるある

#### 作業内容

1. **Phase 1: 天使のノート新規作成**
   - Python 53件
   - JavaScript 49件
   - Bash 39件

2. **Phase 2: 悪魔のノート書き直し**
   - Python 53件
   - JavaScript 49件
   - Bash 39件

3. **slug不一致問題の修正**
   - 最初のSQLで使用したslugがDBの実際のslugと一致していなかった
   - DBから実際のslug一覧を取得して照合
   - 全141エントリに対応した修正版SQLを作成

#### 作成したファイル

| ファイル | 説明 |
|---------|------|
| `supabase/migrations/011_clear_all_notes.sql` | 既存ノートクリア |
| `supabase/migrations/012_angel_notes_python.sql` | Python天使のノート（旧版） |
| `supabase/migrations/013_angel_notes_javascript.sql` | JavaScript天使のノート（旧版） |
| `supabase/migrations/014_angel_notes_bash.sql` | Bash天使のノート（旧版） |
| `supabase/migrations/015_devil_notes_python.sql` | Python悪魔のノート（旧版） |
| `supabase/migrations/016_devil_notes_javascript.sql` | JavaScript悪魔のノート（旧版） |
| `supabase/migrations/017_devil_notes_bash.sql` | Bash悪魔のノート（旧版） |
| `supabase/migrations/018_fix_all_notes.sql` | **修正版（全141件対応）** |

#### 技術的な学び

- **slug命名の重要性**: DBのslugと完全一致しないとUPDATE文がヒットしない
- **確認の重要性**: SQL作成前にDBの実際のデータを確認すべきだった
- **一括処理**: 最初にクリアしてから全件UPDATEする方式が安全

#### 次のアクション

- [x] `018_fix_all_notes.sql` をSupabase SQL Editorで実行
- [x] サイトで表示確認
- [x] Git commit & push

---

### GlobalSearch Bash検索対応

#### 問題
ホーム画面の検索でBashが候補に出てこなかった。

#### 原因
`GlobalSearch.tsx`がmockDataを直接インポートしていた。mockDataにはPython/JavaScriptしかなく、BashはSupabaseにのみ存在していた。

#### 修正
- mockDataインポートを削除
- `@/lib/supabase/client`を直接使用してSupabaseからデータ取得
- クライアントコンポーネントでは`server.ts`（next/headers依存）は使えないため、`client.ts`を使用

#### 学び
- サーバーコンポーネント用のSupabaseクライアント（`server.ts`）はクライアントコンポーネントからインポート不可
- クライアントコンポーネントでは`createBrowserClient`を使う`client.ts`を直接使用する

---

### 用語詳細ページ前後ナビゲーション追加

#### 要件
- 「一覧に戻る」リンク付近に「前の用語」「次の用語」を追加
- 循環ナビゲーション（先頭の「前」は末尾、末尾の「次」は先頭）

#### 実装
- `getEntriesByLanguage`で同言語の全エントリを取得
- 現在のエントリの位置から前後を計算（モジュロ演算で循環）
- UIは3カラムflex配置：左（前）、中央（一覧）、右（次）

#### 修正ファイル
- `src/app/[lang]/[slug]/page.tsx`

---

### 本日の成果まとめ

| 項目 | 内容 |
|------|------|
| 天使のノート | 141件全エントリに追加 |
| 悪魔のノート | 141件全エントリを★★★★★レベルに書き直し |
| バグ修正 | GlobalSearchでBashが出ない問題 |
| 機能追加 | 前後ナビゲーション |

### 次回予定
- 用語（エントリ）の追加
